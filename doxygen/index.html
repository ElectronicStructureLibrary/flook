<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>flook: flook</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">flook
   &#160;<span id="projectnumber">0.5</span>
   </div>
   <div id="projectbrief">FORTRAN wrappers for calling LUA</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">flook </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://travis-ci.org/ElectronicStructureLibrary/flook"></a></p>
<p>The fortran-Lua-hook library.</p>
<p>It allows abstraction of input files to be pure Lua files to enable configuration of internal variables through an embedded Lua interpreter.</p>
<p>Any valid Lua script can be executed from within any fortran application at points where the application creates Lua <em>channels</em>.</p>
<p>Its main usage is the ability to change run-time variables at run-time in order to optimize, or even change, the execution path of the parent program.</p>
<h2>Usage</h2>
<p>The API documentation of flook resides at <a href="http://esl.cecam.org/documentation/flook/master/">documentation</a>.</p>
<p>Imagine you have a program which has 3 distinct places where interaction might occur: </p><pre class="fragment">program main
call initialize()
call calculate()
call finalize()
end program
</pre><p>At each intermediate point one wishes to communicate with a scripting language. flook lets you communicate fortran and Lua. For an elaborate example see <a href="#examples">Examples</a>.</p>
<h2>Downloading and installation</h2>
<p>Installing flook requires you to first fetch the library which is currently hosted at <a href="https://github.com/">github</a> at <a href="https://github.com/ElectronicStructureLibrary/flook">flook</a>.</p>
<p>To fetch all required files do this </p><pre class="fragment">git clone https://github.com/ElectronicStructureLibrary/flook.git
cd flook
git submodule init
git submodule update
ls -l
</pre><p>At this point you should see (<em>at least</em>) the following directories and files: </p><pre class="fragment">drwxr-xr-x 7 USER GROUP 4.0K Jun  5 17:57 aotus
-rw-r--r-- 1 USER GROUP 7.5K Jun  5 17:56 LICENSE
-rw-r--r-- 1 USER GROUP  667 Jun  5 17:56 Makefile
-rw-r--r-- 1 USER GROUP  298 Jun  5 17:56 README.md
drwxr-xr-x 2 USER GROUP 4.0K Jun  5 17:56 src
drwxr-xr-x 2 USER GROUP 4.0K Jun  5 17:56 test
</pre><p>To compile flook you need a minimal <code>arch.make</code> file. The content of <code>arch.make</code>, which should be located in the top directory, can be this minimal content (please correct tabulators to conform to <code>Makefile</code> standards): </p><pre class="fragment">CC = gcc
FC = gfortran
CFLAGS = -g
FFLAGS = -g
.f90.o:
    $(FC) -c $(FFLAGS) $(INC) $&lt;
.F90.o:
    $(FC) -c $(FFLAGS) $(INC) $&lt;
.c.o:
    $(CC) -c $(CFLAGS) $(INC) $&lt;
</pre><p>The <code></code> is needed for internal reasons, (sorry about the quick mock-up)...</p>
<p>Type <code>make</code> and possibly <code>make check</code> to run the tests in the <a href="test/">test</a> directory.</p>
<p>Compiling the internal Lua package requires tweaking if you are using a different platform than <code>linux</code>. </p><pre class="fragment">PLATFORM = aix | bsd | c89 | freebsd | generic | linux | macosx | mingw | posix | solaris
</pre><p>where the default is <code>linux</code>, if using <code>linux</code> supplying <code>PLATFORM</code> to the <code>arch.make</code> file is unnecessary.</p>
<h4>Lua</h4>
<p><a href="https://bitbucket.org/haraldkl/aotus">aotus</a> is packaged together with Lua 5.3.0 and enables the direct compilation of Lua and the fortran bindings. However, if Lua gets updated or you wish to control your Lua environment you can use your local Lua installation.</p>
<p>By adding these flags to your arch.make </p><pre class="fragment">LUA_DIR = /path/to/lua/installation
INC += -I$(LUA_DIR)/include
</pre><p>an external library for the Lua environment will be used.</p>
<h3>Linking</h3>
<p>flook consists intrinsically of 4 libraries:</p>
<ol type="1">
<li>Lua library (<code>-llua</code>),</li>
<li>fortran to Lua interface (<code>-lflu</code>), see <a href="#thanks">Thanks</a>,</li>
<li>basic fortran Lua interaction layer (<code>-laotus</code>), see <a href="#thanks">Thanks</a>,</li>
<li>flook (<code>-lflook</code>).</li>
</ol>
<p>However, two variants of linking is available.</p>
<h4>Compiling for one link</h4>
<p>flook can combine the libraries from 1. - 4. into one library.</p>
<p>To do this simply call make with this command </p><pre class="fragment">make liball
</pre><p>which creates <code>libflookall.a</code> in the top directory. With this library you only need to link to flook.</p>
<p>To link flook to your program the following can be used in a <code>Makefile</code> </p><pre class="fragment">FLOOK_PATH  = /path/to/flook/parent
FLOOK_LIBS  = -L$(FLOOK_PATH)/src -lflookall -ldl
FLOOK_INC   = -I$(FLOOK_PATH)/src
</pre><p>For the sources that you compile you need to add <code></code> to the command line, whilst for linking the program you need <code></code> on the command line. Note that <code>-ldl</code> is a requirement for the Lua library, and per-see is more difficult to incorporate.</p>
<h4>Direct linking</h4>
<p>When <a href="#compiling-for-one-link">compiling for one link</a> does not work, the following method is less restrictive on the commands used.</p>
<p>In order to link to flook you can use this template (<code>Makefile</code>) for include statements and library linking (note that you should <em>not</em> switch the order of these statements): </p><pre class="fragment">FLOOK_PATH  = /path/to/flook/parent
FLOOK_LIBS  = -L$(FLOOK_PATH)/src -lflook
FLOOK_LIBS += -L$(FLOOK_PATH)/aotus/source -laotus
FLOOK_LIBS += -L$(FLOOK_PATH)/aotus/LuaFortran -lflu
FLOOK_LIBS += -L/path/to/lua/lib -llua -ldl
FLOOK_INC   = -I$(FLOOK_PATH)/src
</pre><p>For the sources that you compile you need to add <code></code> to the command line, whilst for linking the program you need <code></code> on the command line.</p>
<h2>Examples</h2>
<p>Several examples exists in the <a href="test/">test</a> directory where one is shown in the following example:</p>
<div class="fragment"></div><!-- fragment --><p>The above program is a fortran program which communicates with an embedded Lua environment. It communicates with Lua 6 times and allows retrieval of elements and changing the elements at each communication point. The communicating Lua code looks like this:</p>
<div class="fragment"></div><!-- fragment --><h2>Contributions, issues and bugs</h2>
<p>I would advice any users to contribute as much feedback and/or PRs to further maintain and expand this library.</p>
<p>Please do not hesitate to contribute!</p>
<p>If you find any bugs please form a <a href="https://github.com/ElectronicStructureLibrary/flook/issues">bug report/issue</a>.</p>
<p>If you have a fix please consider adding a <a href="https://github.com/ElectronicStructureLibrary/flook/pulls">pull request</a>.</p>
<h2>License</h2>
<p>The flook license is <a href="http://www.gnu.org/licenses/lgpl.html">LGPL</a>, please see the LICENSE file.</p>
<h3>Thanks</h3>
<p>First, I owe <a href="https://bitbucket.org/haraldkl">Harald Klimach</a> a big thanks for the creation of <a href="https://bitbucket.org/haraldkl/aotus">aotus</a> for the Lua-Fortran embedment.</p>
<p>Second, I thank <a href="https://github.com/jsspencer">James Spencer</a> for help regarding the <a href="https://bitbucket.org/haraldkl/aotus">aotus</a> API.</p>
<p>Third, I thank <a href="http://esl.cecam.org/">ESL</a> for hosting a workshop for me to participate and create the initial release. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Feb 27 2017 20:48:58 for flook by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
